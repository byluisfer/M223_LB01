<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="./output.css" rel="stylesheet">
    <script src="client.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <title>MiniTwitter</title>
  </head>
  <body class="flex items-start justify-center min-h-screen bg-background">
    <div class="flex flex-col space-x-4 p-4 rounded-xl mt-10 max-w-2xl w-full h-44">
      <button id="logoutBtn" class="absolute top-14 right-10 px-6 py-2 text-white bg-secondary rounded-lg hover:bg-red-500 focus:outline-none transition-colors duration-300">
        Logout
      </button>
      
      <div class="p-4 rounded-xl bg-primary w-full drop-shadow-[0_0px_15px_rgba(242,242,242,0.3)]">
        <input id="tweetInput" type="text" class="w-full p-4 bg-primary text-white outline-none" placeholder="What is happening?!" />
        <button id="postTweet" class="absolute bottom-4 right-4 px-4 py-2 text-white bg-secondary rounded-lg hover:bg-accent hover:text-black focus:outline-none transition-colors duration-300">
          Tweet
        </button>
      </div>

      <div id="tweetsContainer"></div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const tweetInput = document.getElementById('tweetInput');
        const postTweetButton = document.getElementById('postTweet');
        const tweetsContainer = document.getElementById('tweetsContainer');

        postTweetButton.addEventListener('click', async () => {
          const content = tweetInput.value.trim();

          if (!content) {
            alert('âš ï¸ Tweet content cannot be empty!');
            return;
          }

          const response = await fetch('/tweets', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`, // To include the token
            },
            body: JSON.stringify({ content }), // Convert the data to JSON
          });

          const data = await response.json(); // Take the respone (in JSON fromat) and convert it to a JavaScript object
          console.log(data);

          if (response.ok) {
            // Create the HTML element of the tweet || https://www.geeksforgeeks.org/how-to-dynamically-create-new-elements-in-javascript/
            const tweetElement = document.createElement('div');
            tweetElement.className = 'mt-6 p-2 text-white';

            const userElement = document.createElement('h1');
            userElement.className = 'text-xl font-bold';
            userElement.textContent = data.tweet.username;

            const contentElement = document.createElement('p');
            contentElement.className = 'mt-2';
            contentElement.textContent = data.tweet.content;

            const lineElement = document.createElement('hr');
            lineElement.className = 'mt-4 border-t-2 border-gray-300';

            // https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild
            tweetElement.appendChild(userElement);
            tweetElement.appendChild(contentElement);
            tweetElement.appendChild(lineElement);

            // Add the tweet to the container
            tweetsContainer.prepend(tweetElement); // https://developer.mozilla.org/en-US/docs/Web/API/Element/prepend

            tweetInput.value = '';
          } else {
            alert(data.error || 'An error occurred while writing the tweet.');
          }
        });
      });

      // Script to logout
      document.getElementById('logoutBtn').addEventListener('click', () => {
        localStorage.removeItem('token');
        alert('ðŸ«¡ You are logged out');
        window.location.href = '/login';
      });
    </script>
  </body>
</html>
